<!DOCTYPE html> 
<html> 

<head> 
	<title> 
		Dashboard Serra
	</title> 
	<script src= 
"https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"> 
	</script> 
	<script src= 
"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.1.2/chart.umd.js"> 
	</script> 
</head> 

<body>
	<?php
		$servername = "localhost";
		$username = "root";
		$password = "";
		$dbname = "serra";		
		$conn = new mysqli($servername, $username, $password, $dbname);
		// Check connection
		$sql = "SELECT * FROM DHT22 ORDER BY ID ASC LIMIT 30;";
		$result = $conn->query($sql) or die ('Query Error: ' . mysqli_error());
		$time=Array();
		$temp=Array();
		$umi=Array();
		while ($row = $result->fetch_array(MYSQLI_ASSOC)) {
			$time[]=$row["ID"];
			$temp[]=$row["temp"];
			$umi[]=$row["umi"];
		}
		$json_time = json_encode($time);
		$json_temp = json_encode($temp);
		$json_umi = json_encode($umi);
		$conn->close();
	?>
	<h1 style="color:rgb(0, 128, 38);"> 
		Serra 
	</h1> 
	<h3> 
		
	</h3> 
	<canvas id="stackedArea"
			width="800"
			height="350"> 
	</canvas> 
	<script> 
		var time=<?php echo($json_time); ?>;
		var temp=<?php echo($json_temp); ?>;
		var umi=<?php echo($json_umi); ?>;
		var ctx = 
				document.getElementById('stackedArea').getContext('2d'); 
		var myChart = new Chart(ctx, { 
			type: 'line', 
			data: { 
				labels: time,
				datasets: [ 
					{ 
						label: 'Temperatura', 
						data: temp,
						backgroundColor: 'rgba(75, 192, 192, 0.5)', 
						borderColor: 'rgba(75, 192, 192, 1)', 
						borderWidth: 2, 
						fill: true, 
					}, 
					{ 
						label: 'Umidita', 
						data: umi, 
						backgroundColor: 'rgba(255, 99, 132, 0.5)', 
						borderColor: 'rgba(255, 99, 132, 1)', 
						borderWidth: 2, 
						fill: true, 
					}, 
				
				] 
			}, 
			options: { 
				scales: { 
					y: { 
						beginAtZero: true, 
						stacked: true, 
						title: { 
							display: true, 
							text: 'Dati' 
						} 
					}, 
					x: { 
						stacked: true 
					} 
				}, 
				layout: { 
					padding: { 
						left: 20, 
						right: 20, 
						top: 20, 
						bottom: 20 
					} 
				}, 
				plugins: { 
					legend: { 
						position: 'top', 
					}, 
				} 
			} 
		}); 
	</script> 
</body> 

</html>
